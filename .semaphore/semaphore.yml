version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Auto-Deploy to CDN
    task:
      jobs:
        - name: Deploy
          commands:
            - checkout
            - export YEAR=$(date +'%Y')
            - export MONTH=$(date +'%m')
            - export DAY=$(date +'%d')
            - 'git clone https://github.com/PatternHouse/cdn.git'
            - mkdir -pv cdn/store
            - cp -r patterns/. cdn/store/
            - cd cdn
            - 'echo LAST_DEPLOY_DATE:$YEAR/$MONTH/$DAY > state.dat'
            - git config user.name $SM_DEPLOY_GITHUB_NAME
            - git config user.email $SM_DEPLOY_GITHUB_EMAIL
            - git add *
            - git status
            - 'git commit -a -m "Semaphore CI/CD : Updating Guidelines CDN Store ... "'
            - 'git push https://$SM_DEPLOY_GITHUB_NAME:$SM_DEPLOY_GITHUB_PASSWORD@github.com/PatternHouse/cdn.git'
      secrets:
        - name: Semaphore Deployments Variables
